{
  "id": "snapshot_1766427473534_6eer62zgn",
  "approvalId": "approval_1766427473530_oryg03u41",
  "approvalTitle": "Tasks for Virtual E2E Testing",
  "version": 1,
  "timestamp": "2025-12-22T18:17:53.534Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 1: Core Virtual Device Infrastructure\n\n- [ ] 1. Create test_utils module structure\n  - File: `keyrx_daemon/src/test_utils/mod.rs` (NEW)\n  - Create module directory and mod.rs\n  - Define VirtualDeviceError enum with thiserror\n  - Export submodules (virtual_keyboard, output_capture)\n  - Purpose: Establish test utility module structure\n  - _Leverage: keyrx_daemon/src/platform/mod.rs pattern for module organization_\n  - _Requirements: 1.1, 2.1_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer specializing in module organization and error types\n    Task: Create the test_utils module structure with VirtualDeviceError enum following requirements 1.1 and 2.1, using the platform module as a reference pattern\n    Restrictions: Do not implement VirtualKeyboard or OutputCapture yet, only the module structure and error type. Keep error messages actionable with fix instructions.\n    Success: Module compiles, VirtualDeviceError has all variants (PermissionDenied, NotFound, Timeout, Io, CreationFailed), proper exports configured\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 2. Implement VirtualKeyboard struct\n  - File: `keyrx_daemon/src/test_utils/virtual_keyboard.rs` (NEW)\n  - Create VirtualKeyboard struct with uinput device\n  - Implement create(name) method with full keyboard capabilities\n  - Use unique device names (include timestamp/random suffix)\n  - Purpose: Enable test input injection via uinput\n  - _Leverage: keyrx_daemon/src/platform/linux/mod.rs UinputOutput::create pattern_\n  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with Linux uinput expertise\n    Task: Implement VirtualKeyboard::create() following requirements 1.1-1.5, using UinputOutput as reference for uinput device creation\n    Restrictions: Focus only on device creation and name handling. Do not implement inject() yet. Use existing keycode_map module for key registration.\n    Success: VirtualKeyboard::create(\"test\") returns device, device appears in /dev/input/, device has identifiable name, device is destroyed on drop\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 3. Implement VirtualKeyboard event injection\n  - File: `keyrx_daemon/src/test_utils/virtual_keyboard.rs` (continue)\n  - Implement inject(KeyEvent) method\n  - Write EV_KEY + EV_SYN events to uinput\n  - Implement inject_sequence with optional delay\n  - Purpose: Enable injecting test key events\n  - _Leverage: keyrx_daemon/src/platform/linux/mod.rs UinputOutput::inject_event pattern, keycode_map::keycode_to_evdev_\n  - _Requirements: 1.2, 1.3_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with Linux input subsystem expertise\n    Task: Implement VirtualKeyboard::inject() and inject_sequence() following requirements 1.2 and 1.3, using UinputOutput::inject_event as reference\n    Restrictions: Must write SYN_REPORT after each key event. Use keycode_to_evdev for key conversion. Handle both Press and Release correctly (value=1 and value=0).\n    Success: inject(Press(A)) writes correct evdev event, inject(Release(A)) writes correct event, inject_sequence works with delays\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 4. Write VirtualKeyboard unit tests\n  - File: `keyrx_daemon/src/test_utils/virtual_keyboard.rs` (add tests module)\n  - Test device creation and naming\n  - Test device cleanup on drop\n  - Test event injection produces readable events\n  - Purpose: Verify VirtualKeyboard works correctly\n  - _Leverage: keyrx_daemon/src/platform/linux/mod.rs test patterns_\n  - _Requirements: 1.1, 1.2, 1.3, 1.4_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust QA Engineer with testing expertise\n    Task: Write comprehensive unit tests for VirtualKeyboard covering requirements 1.1-1.4\n    Restrictions: Tests that require /dev/uinput should be marked #[ignore] with clear instructions. Include test for permission denied scenario.\n    Success: Tests cover creation, injection, drop cleanup, all tests pass or are appropriately ignored with documentation\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n## Phase 2: Output Capture Implementation\n\n- [ ] 5. Implement OutputCapture struct\n  - File: `keyrx_daemon/src/test_utils/output_capture.rs` (NEW)\n  - Create OutputCapture struct wrapping evdev::Device\n  - Implement find_by_name(name, timeout) with polling\n  - Enumerate /dev/input/event* and match by name\n  - Purpose: Enable finding and opening daemon's output device\n  - _Leverage: keyrx_daemon/src/device_manager/linux.rs enumerate_keyboards pattern_\n  - _Requirements: 2.1_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with Linux evdev expertise\n    Task: Implement OutputCapture::find_by_name() following requirement 2.1, using device_manager enumerate_keyboards as reference\n    Restrictions: Must poll for device existence (device may not exist immediately). Return Timeout error if not found within duration. Do not grab the device.\n    Success: find_by_name(\"keyrx Virtual Keyboard\", 5s) finds existing device, returns Timeout for non-existent device, handles race conditions\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 6. Implement OutputCapture event reading\n  - File: `keyrx_daemon/src/test_utils/output_capture.rs` (continue)\n  - Implement next_event(timeout) with non-blocking read\n  - Implement collect_events(timeout) to gather multiple events\n  - Implement drain() to clear pending events\n  - Filter to EV_KEY events only (ignore EV_SYN, etc.)\n  - Purpose: Enable reading output events from daemon\n  - _Leverage: keyrx_daemon/src/platform/linux/mod.rs EvdevInput::next_event pattern, keycode_map::evdev_to_keycode_\n  - _Requirements: 2.2, 2.3, 2.4_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with async I/O expertise\n    Task: Implement OutputCapture event reading methods following requirements 2.2-2.4, using EvdevInput as reference\n    Restrictions: Use non-blocking reads with poll/select. Convert evdev events to KeyEvent using evdev_to_keycode. Only capture EV_KEY events.\n    Success: next_event returns events with timeout, collect_events gathers all pending events, drain clears buffer\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 7. Implement OutputCapture assertion helpers\n  - File: `keyrx_daemon/src/test_utils/output_capture.rs` (continue)\n  - Implement assert_events(captured, expected) with detailed diff\n  - Show expected vs actual with markers for mismatches\n  - Handle extra/missing events clearly\n  - Purpose: Enable clear test assertions\n  - _Leverage: Standard Rust testing patterns_\n  - _Requirements: 2.5_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust QA Engineer specializing in test assertions\n    Task: Implement assert_events helper following requirement 2.5\n    Restrictions: Do not panic with opaque errors. Show side-by-side comparison. Mark mismatches, extras, and missing events clearly.\n    Success: Assertion failure shows detailed diff, passing assertion returns cleanly, handles empty sequences\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 8. Write OutputCapture unit tests\n  - File: `keyrx_daemon/src/test_utils/output_capture.rs` (add tests module)\n  - Test device discovery by name\n  - Test timeout behavior\n  - Test event reading and filtering\n  - Test assertion helper formatting\n  - Purpose: Verify OutputCapture works correctly\n  - _Leverage: VirtualKeyboard for creating test devices_\n  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust QA Engineer with testing expertise\n    Task: Write comprehensive unit tests for OutputCapture covering requirements 2.1-2.5\n    Restrictions: Use VirtualKeyboard to create devices for testing OutputCapture. Tests requiring /dev/uinput should be #[ignore].\n    Success: Tests cover discovery, reading, assertions, all tests pass or are appropriately ignored\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n## Phase 3: E2E Test Harness\n\n- [ ] 9. Create E2EError type and helpers\n  - File: `keyrx_daemon/tests/e2e_harness.rs` (NEW)\n  - Define E2EError enum with all error variants\n  - Create E2EConfig struct for test configuration\n  - Implement helper constructors (simple_remap, modifier, conditional)\n  - Purpose: Establish harness error handling and config helpers\n  - _Leverage: keyrx_core/src/config/mappings.rs KeyMapping constructors_\n  - _Requirements: 3.1, 3.4, 3.6_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer specializing in test infrastructure\n    Task: Create E2EError and E2EConfig types following requirements 3.1, 3.4, 3.6\n    Restrictions: E2EError must wrap VirtualDeviceError. E2EConfig helpers should use existing KeyMapping constructors. Include VerificationFailed variant with captured/expected.\n    Success: E2EError covers all failure modes, E2EConfig::simple_remap/modifier/conditional work correctly\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 10. Implement E2EHarness::setup\n  - File: `keyrx_daemon/tests/e2e_harness.rs` (continue)\n  - Implement setup(config) method\n  - Create VirtualKeyboard with unique name\n  - Generate .krx config file matching virtual keyboard\n  - Start daemon as subprocess with config\n  - Wait for daemon to grab device and create output\n  - Find and open output device\n  - Purpose: Initialize complete E2E test environment\n  - _Leverage: keyrx_compiler serialize for .krx generation, tempfile for temp config_\n  - _Requirements: 3.1_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with subprocess and IPC expertise\n    Task: Implement E2EHarness::setup() following requirement 3.1\n    Restrictions: Use unique device names to support parallel tests. Daemon must be started as subprocess (not in-process). Wait for daemon to be ready before returning. Capture daemon stderr for diagnostics.\n    Success: setup() returns harness with working virtual keyboard, running daemon, and connected output capture\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 11. Implement E2EHarness inject and capture methods\n  - File: `keyrx_daemon/tests/e2e_harness.rs` (continue)\n  - Implement inject(events) delegating to VirtualKeyboard\n  - Implement capture(timeout) delegating to OutputCapture\n  - Implement inject_and_capture convenience method\n  - Implement verify(captured, expected) using assert_events\n  - Purpose: Provide test interaction methods\n  - _Leverage: VirtualKeyboard::inject_sequence, OutputCapture::collect_events_\n  - _Requirements: 3.2, 3.3, 3.4_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer specializing in test infrastructure\n    Task: Implement E2EHarness interaction methods following requirements 3.2-3.4\n    Restrictions: inject_and_capture should drain output before injecting to avoid stale events. verify should use OutputCapture::assert_events.\n    Success: inject/capture/verify methods work correctly, inject_and_capture is atomic\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 12. Implement E2EHarness teardown and Drop\n  - File: `keyrx_daemon/tests/e2e_harness.rs` (continue)\n  - Implement teardown(self) for graceful cleanup\n  - Send SIGTERM to daemon process\n  - Wait for daemon to exit with timeout\n  - Destroy virtual keyboard\n  - Remove temporary config file\n  - Implement Drop trait for panic-safe cleanup\n  - Purpose: Ensure clean resource cleanup\n  - _Leverage: nix crate for signal sending_\n  - _Requirements: 3.5_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with systems programming expertise\n    Task: Implement E2EHarness::teardown() and Drop following requirement 3.5\n    Restrictions: Must handle case where daemon already exited. SIGKILL as fallback after SIGTERM timeout. Drop must not panic. Clean up all resources even on partial failure.\n    Success: teardown cleans up all resources, Drop works on panic, no orphaned processes or devices\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 13. Add TestEvents helper\n  - File: `keyrx_daemon/tests/e2e_harness.rs` (continue)\n  - Create TestEvents struct with helper methods\n  - Implement press(key), release(key), tap(key)\n  - Implement type_keys(keys) for sequences\n  - Purpose: Simplify test event creation\n  - _Leverage: keyrx_core::runtime::event::KeyEvent_\n  - _Requirements: 5.1-5.7_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer specializing in ergonomic APIs\n    Task: Create TestEvents helper for concise test event creation\n    Restrictions: Methods should be associated functions (no self). Return types should be compatible with harness.inject().\n    Success: TestEvents::tap(KeyCode::A) returns [Press(A), Release(A)], type_keys works for sequences\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n## Phase 4: E2E Test Cases\n\n- [ ] 14. Create virtual_e2e_tests.rs with simple remap tests\n  - File: `keyrx_daemon/tests/virtual_e2e_tests.rs` (NEW)\n  - Test simple A→B remap (press and release)\n  - Test multiple remaps in sequence\n  - Test unmapped key passthrough\n  - Purpose: Verify basic remapping works end-to-end\n  - _Leverage: E2EHarness, TestEvents_\n  - _Requirements: 5.1, 5.6_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust QA Engineer specializing in E2E testing\n    Task: Write E2E tests for simple remapping covering requirements 5.1 and 5.6\n    Restrictions: Tests should be self-contained (setup/teardown per test). Mark tests #[ignore] with clear instructions for running. Use descriptive test names.\n    Success: Tests verify press→press, release→release, passthrough for unmapped keys\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 15. Add modifier and lock state tests\n  - File: `keyrx_daemon/tests/virtual_e2e_tests.rs` (continue)\n  - Test modifier activation (no output, state change)\n  - Test lock toggle (toggle on press, ignore release)\n  - Test conditional mapping with modifier active\n  - Test conditional mapping without modifier (passthrough)\n  - Purpose: Verify modifier/lock state management\n  - _Leverage: E2EHarness, E2EConfig::conditional_\n  - _Requirements: 5.2, 5.3, 5.4_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust QA Engineer specializing in state-based testing\n    Task: Write E2E tests for modifier and lock behavior covering requirements 5.2-5.4\n    Restrictions: Test both active and inactive modifier states. Verify lock toggles on second press. Test conditional mappings thoroughly.\n    Success: Tests verify modifier sets internal state, lock toggles, conditionals work correctly\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 16. Add modified output tests\n  - File: `keyrx_daemon/tests/virtual_e2e_tests.rs` (continue)\n  - Test Shift+Key output sequence (modifier ordering)\n  - Test Ctrl+Key combination\n  - Test multiple modifiers (Ctrl+Shift+Key)\n  - Verify correct press/release ordering\n  - Purpose: Verify modified output sequences\n  - _Leverage: E2EHarness, KeyMapping::modified_output_\n  - _Requirements: 5.5_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust QA Engineer specializing in E2E testing\n    Task: Write E2E tests for modified output behavior covering requirement 5.5\n    Restrictions: Verify exact ordering: Press(modifiers) → Press(key) → Release(key) → Release(modifiers). Test with multiple modifier combinations.\n    Success: Tests verify Shift+Key, Ctrl+Key, multi-modifier sequences with correct ordering\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 17. Add multi-event sequence tests\n  - File: `keyrx_daemon/tests/virtual_e2e_tests.rs` (continue)\n  - Test typing pattern (multiple taps in sequence)\n  - Test modifier hold during typing\n  - Test state accumulation across events\n  - Test complex vim-style navigation layer\n  - Purpose: Verify complex event sequences\n  - _Leverage: E2EHarness, TestEvents::type_keys_\n  - _Requirements: 5.7_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust QA Engineer specializing in integration testing\n    Task: Write E2E tests for complex event sequences covering requirement 5.7\n    Restrictions: Test realistic typing patterns. Verify no event loss or reordering. Include vim-navigation-layer test.\n    Success: Tests verify complex sequences work correctly, state persists across events\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n## Phase 5: CI/CD Integration\n\n- [ ] 18. Update Cargo.toml with test dependencies\n  - File: `keyrx_daemon/Cargo.toml` (MODIFY)\n  - Add dev-dependencies: tempfile, nix (for signals)\n  - Ensure evdev and uinput are available in test builds\n  - Configure test binary for virtual_e2e_tests\n  - Purpose: Enable compilation of E2E test infrastructure\n  - _Leverage: Existing Cargo.toml structure_\n  - _Requirements: 4.1_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with Cargo expertise\n    Task: Update Cargo.toml with required test dependencies for virtual E2E tests\n    Restrictions: Add to [dev-dependencies] only. Do not modify production dependencies. Keep versions consistent with existing deps.\n    Success: cargo test --test virtual_e2e_tests compiles successfully\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 19. Create CI workflow for virtual E2E tests\n  - File: `.github/workflows/ci.yml` (MODIFY)\n  - Add virtual-e2e job that runs on ubuntu-latest\n  - Setup uinput permissions (modprobe, chmod)\n  - Run virtual E2E tests with --ignored flag\n  - Capture test output and daemon logs on failure\n  - Purpose: Enable automated E2E testing in CI\n  - _Leverage: Existing ci.yml structure_\n  - _Requirements: 4.1, 4.2, 4.3, 4.4_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: DevOps Engineer with GitHub Actions expertise\n    Task: Add virtual E2E test job to CI workflow following requirements 4.1-4.4\n    Restrictions: Use sudo for uinput setup. Run tests with cargo test --test virtual_e2e_tests -- --ignored. Upload logs as artifacts on failure.\n    Success: CI job runs virtual E2E tests without hardware, reports clear pass/fail\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 20. Add test timeout handling\n  - File: `keyrx_daemon/tests/e2e_harness.rs` (MODIFY)\n  - Add test-level timeout wrapper\n  - Force cleanup if test exceeds timeout\n  - Kill daemon process if hung\n  - Report timeout with diagnostic context\n  - Purpose: Prevent hung tests from blocking CI\n  - _Leverage: std::thread::spawn for timeout wrapper_\n  - _Requirements: 4.5_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with concurrent programming expertise\n    Task: Add test timeout handling following requirement 4.5\n    Restrictions: Default timeout should be generous (30 seconds). Cleanup must run even on timeout. Report which phase timed out.\n    Success: Hung tests are killed after timeout, resources cleaned up, clear timeout error reported\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n## Phase 6: Documentation and Integration\n\n- [ ] 21. Add module documentation\n  - File: `keyrx_daemon/src/test_utils/mod.rs` (MODIFY)\n  - Add comprehensive module-level documentation\n  - Document each public type and function\n  - Include usage examples in doc comments\n  - Purpose: Enable discoverability and correct usage\n  - _Leverage: Existing rustdoc patterns in codebase_\n  - _Requirements: Non-functional (Usability)_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Technical Writer with Rust documentation expertise\n    Task: Add comprehensive rustdoc documentation to test_utils module\n    Restrictions: Include code examples that compile (doc tests). Document error conditions and panics. Follow existing codebase documentation style.\n    Success: cargo doc generates clean documentation, examples compile, all public items documented\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 22. Update existing e2e_tests.rs with references\n  - File: `keyrx_daemon/tests/e2e_tests.rs` (MODIFY)\n  - Add comment pointing to virtual_e2e_tests.rs for CI-compatible tests\n  - Document which tests require real hardware vs virtual devices\n  - Keep existing hardware tests as manual verification option\n  - Purpose: Clarify relationship between test files\n  - _Leverage: Existing test documentation patterns_\n  - _Requirements: Non-functional (Usability)_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: Rust Developer with testing expertise\n    Task: Update existing e2e_tests.rs with documentation linking to virtual tests\n    Restrictions: Do not modify test logic. Add header comments explaining the difference. Keep hardware tests intact.\n    Success: e2e_tests.rs clearly documents when to use hardware vs virtual tests\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n\n- [ ] 23. Run full test suite and verify CI\n  - File: N/A (verification task)\n  - Run all unit tests: `cargo test --lib`\n  - Run virtual E2E tests locally: `cargo test --test virtual_e2e_tests -- --ignored`\n  - Verify CI workflow passes on PR\n  - Fix any flaky tests or timing issues\n  - Purpose: Final verification of E2E testing infrastructure\n  - _Leverage: All implemented components_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec virtual-e2e-testing, first run spec-workflow-guide to get the workflow guide then implement the task:\n    Role: QA Engineer with CI/CD expertise\n    Task: Run full test suite and verify CI integration\n    Restrictions: All tests must pass. No flaky tests allowed. CI must report clear results. Fix any issues found.\n    Success: All tests pass locally and in CI, no flaky tests, clean CI output\n    After completion: Mark task [-] as in-progress before starting, use log-implementation tool to record what was built, then mark [x] as complete_\n",
  "fileStats": {
    "size": 26036,
    "lines": 374,
    "lastModified": "2025-12-22T18:17:26.196Z"
  },
  "comments": []
}