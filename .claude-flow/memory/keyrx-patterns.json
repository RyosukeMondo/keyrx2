{
  "version": "1.0.0",
  "description": "Pre-loaded memory patterns for keyrx development",
  "patterns": [
    {
      "id": "rust-module-structure",
      "category": "code-organization",
      "domain": "Core",
      "pattern": {
        "name": "Standard Rust module structure",
        "structure": [
          "Module documentation (//!)",
          "Imports (std → external → workspace → local)",
          "Constants (UPPER_SNAKE_CASE)",
          "Type definitions (structs, enums)",
          "Implementations",
          "Helper functions (private)",
          "Tests (#[cfg(test)])"
        ],
        "example": "keyrx_core/src/lookup.rs",
        "constraints": [
          "Max 500 lines per file",
          "Max 50 lines per function"
        ]
      },
      "successRate": 0.98,
      "usage": 156
    },
    {
      "id": "react-component-pattern",
      "category": "code-organization",
      "domain": "UI",
      "pattern": {
        "name": "Standard React component structure",
        "structure": [
          "Imports (React → external → internal → relative → styles)",
          "TypeScript interfaces",
          "Component function",
          "Hooks (useState, useEffect, custom)",
          "Event handlers",
          "Render helpers",
          "Effects",
          "Return JSX",
          "Local helper components"
        ],
        "example": "keyrx_ui/src/components/KeyboardVisualizer.tsx",
        "constraints": [
          "TypeScript strict mode",
          "WCAG accessibility",
          "Max 500 lines per file"
        ]
      },
      "successRate": 0.96,
      "usage": 142
    },
    {
      "id": "api-endpoint-creation",
      "category": "backend",
      "domain": "Daemon",
      "pattern": {
        "name": "Axum REST API endpoint",
        "steps": [
          "Define request/response types",
          "Implement handler function",
          "Add route to Router in mod.rs",
          "Add CORS if needed",
          "Add error handling",
          "Log structured JSON",
          "Write unit tests"
        ],
        "example": "keyrx_daemon/src/web/api/devices.rs",
        "template": {
          "handler": "async fn handler(State(state): State<AppState>) -> Result<Json<Response>, Error>",
          "route": ".route(\"/api/endpoint\", get(handler))",
          "logging": "log::info!(target: \"keyrx_daemon\", event_type = \"api_call\", endpoint = \"/api/endpoint\")"
        }
      },
      "successRate": 0.99,
      "usage": 87
    },
    {
      "id": "websocket-event-handling",
      "category": "backend",
      "domain": "Daemon",
      "pattern": {
        "name": "WebSocket real-time event handling",
        "steps": [
          "Define event message type",
          "Implement broadcast mechanism",
          "Add to WebSocket handler",
          "Update frontend WebSocket client",
          "Test real-time updates"
        ],
        "example": "keyrx_daemon/src/web/ws.rs",
        "template": {
          "message": "{\"type\": \"event_type\", \"data\": {...}}",
          "broadcast": "tx.send(Message::Text(json)).await"
        }
      },
      "successRate": 0.95,
      "usage": 63
    },
    {
      "id": "wasm-binding",
      "category": "frontend",
      "domain": "UI",
      "pattern": {
        "name": "WASM Rust-JS binding",
        "steps": [
          "Add #[wasm_bindgen] to Rust function",
          "Use serde for complex types",
          "Build with wasm-pack",
          "Import in TypeScript",
          "Handle async if needed"
        ],
        "example": "keyrx_core/src/wasm/mod.rs",
        "template": {
          "rust": "#[wasm_bindgen]\npub fn simulate_event(event: JsValue) -> Result<JsValue, JsValue>",
          "typescript": "import { simulate_event } from '@/wasm/pkg'"
        }
      },
      "successRate": 0.97,
      "usage": 45
    },
    {
      "id": "deterministic-test",
      "category": "testing",
      "domain": "Testing",
      "pattern": {
        "name": "Deterministic Simulation Test",
        "steps": [
          "Create virtual clock",
          "Define event sequence",
          "Run simulation",
          "Verify state transitions",
          "Check determinism (run twice, same result)"
        ],
        "example": "keyrx_core/tests/dfa_tests.rs",
        "constraints": [
          "No wall-clock dependencies",
          "Seeded RNG if randomness needed",
          "Same input → same output"
        ]
      },
      "successRate": 0.98,
      "usage": 78
    },
    {
      "id": "property-based-test",
      "category": "testing",
      "domain": "Testing",
      "pattern": {
        "name": "Property-based test with proptest",
        "steps": [
          "Define property to test",
          "Implement Arbitrary trait for types",
          "Write proptest! macro test",
          "Verify invariants hold",
          "Check shrinking on failure"
        ],
        "example": "keyrx_core/src/lookup.rs",
        "template": {
          "test": "proptest! {\n  #[test]\n  fn property_name(input: u32) {\n    prop_assert!(invariant(input));\n  }\n}"
        }
      },
      "successRate": 0.94,
      "usage": 56
    },
    {
      "id": "multi-device-config",
      "category": "configuration",
      "domain": "Configuration",
      "pattern": {
        "name": "Multi-device Rhai configuration",
        "structure": [
          "main.rhai - Single entry point",
          "devices/ - Per-device configs",
          "layers/ - Shared layer definitions",
          "macros/ - Utility functions"
        ],
        "example": "examples/multi-device/main.rhai",
        "template": {
          "main": "import \"devices/left_hand.rhai\";\nimport \"devices/right_hand.rhai\";\nimport \"layers/vim_mode.rhai\";",
          "device": "let left = device(\"USB\\\\SERIAL_LEFT\");\nleft.map(Key::A, Key::B);"
        }
      },
      "successRate": 0.93,
      "usage": 34
    },
    {
      "id": "platform-trait-impl",
      "category": "platform",
      "domain": "Platform",
      "pattern": {
        "name": "Platform trait implementation",
        "steps": [
          "Implement Platform trait",
          "Implement capture_input",
          "Implement inject_output",
          "Add platform-specific feature gate",
          "Write platform-specific tests"
        ],
        "example": "keyrx_daemon/src/platform/linux.rs",
        "template": {
          "trait": "impl Platform for LinuxPlatform {\n  fn capture_input(&mut self) -> Result<KeyEvent> { ... }\n  fn inject_output(&mut self, event: KeyEvent) -> Result<()> { ... }\n}",
          "feature": "#[cfg(target_os = \"linux\")]"
        }
      },
      "successRate": 0.97,
      "usage": 28
    },
    {
      "id": "error-handling-pattern",
      "category": "error-handling",
      "domain": "All",
      "pattern": {
        "name": "Fail-fast error handling",
        "principles": [
          "Validate at entry point",
          "Reject invalid input immediately",
          "Use Result<T, E> for fallible operations",
          "Structured error logging (JSON)",
          "Never log secrets/PII"
        ],
        "template": {
          "validation": "if !input.is_valid() { return Err(Error::InvalidInput); }",
          "logging": "log::error!(target: \"keyrx\", event_type = \"error\", error = %e, context = ?ctx)",
          "propagation": "let result = fallible_operation()?;"
        }
      },
      "successRate": 0.99,
      "usage": 203
    }
  ],
  "codebaseKnowledge": {
    "architecture": {
      "crates": [
        {
          "name": "keyrx_core",
          "type": "library",
          "constraints": ["no_std", "WASM-compilable"],
          "purpose": "Platform-agnostic remapping logic",
          "keyFiles": ["lookup.rs", "dfa.rs", "state.rs", "simulator.rs"]
        },
        {
          "name": "keyrx_compiler",
          "type": "binary",
          "purpose": "Rhai → .krx compiler",
          "keyFiles": ["parser.rs", "mphf_gen.rs", "dfa_gen.rs"]
        },
        {
          "name": "keyrx_daemon",
          "type": "binary",
          "purpose": "OS integration + web server",
          "keyFiles": ["platform/linux.rs", "platform/windows.rs", "web/api.rs", "web/ws.rs"]
        },
        {
          "name": "keyrx_ui",
          "type": "frontend",
          "purpose": "React + WASM UI",
          "keyFiles": ["App.tsx", "components/", "hooks/", "wasm/"]
        }
      ],
      "crossCuttingConcerns": {
        "ssot": ".krx binary is canonical config",
        "logging": "JSON format with timestamp, level, service, event_type, context",
        "determinism": "Same input → same output",
        "latency": "<100μs target, <1ms hard limit"
      }
    },
    "qualityGates": {
      "coverage": {
        "minimum": 80,
        "core": 90
      },
      "limits": {
        "linesPerFile": 500,
        "linesPerFunction": 50
      },
      "enforcement": ["pre-commit hooks", "CI/CD gates"]
    },
    "testingStrategies": {
      "unit": "cargo test, vitest",
      "dst": "Deterministic Simulation Testing with virtual clock",
      "pbt": "Property-Based Testing with proptest",
      "fuzz": "Fuzz testing with cargo-fuzz",
      "e2e": "Playwright for browser automation",
      "vm": "Vagrant for Windows cross-platform testing"
    }
  },
  "commonTasks": [
    {
      "task": "Add API endpoint",
      "pattern": "api-endpoint-creation",
      "files": ["keyrx_daemon/src/web/api/*.rs"],
      "tests": ["keyrx_daemon/tests/api/*.rs"]
    },
    {
      "task": "Add React component",
      "pattern": "react-component-pattern",
      "files": ["keyrx_ui/src/components/*.tsx"],
      "tests": ["keyrx_ui/src/__tests__/*.test.tsx"]
    },
    {
      "task": "Add WASM binding",
      "pattern": "wasm-binding",
      "files": ["keyrx_core/src/wasm/mod.rs", "keyrx_ui/src/wasm/*.ts"]
    },
    {
      "task": "Add platform support",
      "pattern": "platform-trait-impl",
      "files": ["keyrx_daemon/src/platform/*.rs"]
    },
    {
      "task": "Write deterministic test",
      "pattern": "deterministic-test",
      "files": ["keyrx_core/tests/*.rs"]
    }
  ],
  "metadata": {
    "createdAt": "2026-01-25T07:57:26Z",
    "codebaseVersion": "0.1.0",
    "totalPatterns": 10,
    "totalUsage": 1042,
    "averageSuccessRate": 0.966
  }
}
